<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconhecimento de Gestos com as M칚os</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS Personalizado -->
    <link rel="stylesheet" href="style.css">

    <!-- Webcam.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.25/webcam.min.js"></script>

    <!-- ml5.js -->
    <script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js"></script>
</head>
<body>
    <!-- Cabe칞alho -->
    <header class="bg-primary text-white text-center py-3">
        <h1>Aplicativo de Reconhecimento de Gestos com as M칚os 游녦</h1>
    </header>

    <div class="container mt-4">
        <!-- Lista de 칈cones de Gestos -->
        <div class="mb-4 text-center">
            <h5>Gestos de M칚o Suportados</h5>
            <p>游녨 (U+1F44D), 九껊잺 (U+270C), 游뱇 (U+1F919)</p>
        </div>

        <!-- Visualiza칞칚o da Webcam -->
        <div id="webcam" class="d-flex justify-content-center mb-4">
            <!-- O feed da webcam ser치 exibido aqui -->
        </div>

        <!-- Bot칚o para Capturar Imagem -->
        <div class="text-center mb-4">
            <button class="btn btn-success" onclick="captureImage()">Capturar Imagem</button>
        </div>

        <!-- Exibi칞칚o do Nome do Gesto -->
        <div class="text-center mb-4">
            <span id="gesture-name" class="h4">Nome do Gesto</span>
        </div>

        <!-- Exibi칞칚o do 칈cone do Gesto -->
        <div class="text-center mb-4">
            <span id="gesture-icon" class="h4">游뱂</span> <!-- 칈cone padr칚o -->
        </div>

        <!-- Exibi칞칚o da Imagem Capturada -->
        <div id="captured-image" class="d-flex justify-content-center mb-4">
            <!-- A imagem capturada ser치 exibida aqui -->
        </div>

        <!-- Bot칚o para Identificar o Gesto -->
        <div class="text-center">
            <button class="btn btn-primary" onclick="identifyGesture()">Identificar Gesto</button>
        </div>
    </div>

    <!-- Arquivo JavaScript Principal -->
    <script src="main.js"></script>

    <script>
        // Configurar webcam
        Webcam.set({
            width: 320,
            height: 240,
            image_format: 'jpeg',
            jpeg_quality: 90
        });
        Webcam.attach('#webcam');

        // Carregar modelo ml5
        const modelUrl = 'https://teachablemachine.withgoogle.com/models/z3Bf589Xi/model.json';
        let classifier;

        ml5.imageClassifier(modelUrl)
            .then(model => {
                classifier = model;
                console.log('Modelo carregado:', classifier);
            })
            .catch(error => console.error('Erro ao carregar o modelo:', error));

        // Fun칞칚o para capturar a imagem
        function captureImage() {
            Webcam.snap(function(data_uri) {
                document.getElementById('captured-image').innerHTML = 
                    '<img src="'+data_uri+'" class="img-fluid"/>';
                check(); // Chamar a fun칞칚o para comparar a imagem capturada
            });
        }

        // Fun칞칚o para comparar a imagem capturada usando o modelo
        function check() {
            const imgElement = document.querySelector('#captured-image img');
            if (imgElement && classifier) {
                classifier.classify(imgElement, gotResult);
            }
        }

        // Fun칞칚o que lida com o resultado da classifica칞칚o
        function gotResult(error, results) {
            if (error) {
                console.error('Erro:', error);
                return;
            }

            const gestureName = results[0].label;
            const confidence = results[0].confidence.toFixed(2) * 100; // Confian칞a em porcentagem

            // Atualiza o nome do gesto e o 칤cone
            document.getElementById('gesture-name').innerText = `${gestureName} (${confidence}%)`;
            const gestureIcon = getGestureIcon(gestureName);
            document.getElementById('gesture-icon').innerText = gestureIcon;

            // Verifica o gesto e fala o significado
            if (gestureName === 'legal') {
                speak('Gesto de legal');
            } else if (gestureName === 'vit칩ria') {
                speak('Gesto de vit칩ria');
            } else if (gestureName === 'tranquilo') {
                speak('Gesto de tranquilidade');
            } else {
                speak('Gesto desconhecido.');
            }
        }

        // Fun칞칚o para obter o 칤cone do gesto baseado no nome
        function getGestureIcon(gestureName) {
            const icons = {
                'legal': '游녨',
                'vit칩ria': '九껊잺',
                'tranquilo': '游뱇'
            };
            return icons[gestureName] || '游뱂';
        }

        // Fun칞칚o para falar o significado do gesto
        function speak(message) {
            const synth = window.speechSynthesis;
            const utterThis = new SpeechSynthesisUtterance(message);
            synth.speak(utterThis);
        }

        // Console a vers칚o ml5.js
        console.log('Vers칚o ml5.js:', ml5.version);
    </script>
</body>
</html>
